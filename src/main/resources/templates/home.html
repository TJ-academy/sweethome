<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>홈 스윗 홈</title>

<link rel="stylesheet" th:href="@{/css/fragments/fragments.css}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

<link rel="stylesheet" th:href="@{/css/home/homeList.css}">
</head>

<body>
<div th:insert="fragments/header :: menuBar"></div>
<div th:insert="fragments/search :: searchSection"></div>

<div class="container">
    <div class="list-header-toggle" id="listHeaderToggle">
        <h2 th:text="${param.keyword != null ? '검색 결과' : '전체 숙소 목록'}">전체 숙소 목록</h2>
        <span class="toggle-arrow"></span>
    </div>

    <div id="homeListContainer" class="row">
        <div class="home-item" th:each="homeDto, iterStat : ${homeList}" 
             th:classappend="${iterStat.index >= 10} ? 'hidden-item'">
            <a th:href="@{/home/detail/{homeIdx}(homeIdx=${homeDto.home.idx})}" class="home-link">
                <img th:src="${homeDto.home.thumbnail != null && !homeDto.home.thumbnail.isEmpty() ? homeDto.home.thumbnail : '/images/no-image.jpg'}"
                     alt="숙소 이미지" class="home-img">
            </a>
            <div class="home-text">
                <h3 class="home-title" th:text="${homeDto.home.title}">숙소 제목</h3>
                <p class="home-desc" th:text="${homeDto.home.address}">숙소 주소</p>
                <p class="home-like">❤️ <span th:text="${homeDto.likeCount}">0</span></p>
            </div>
        </div>
    </div>
    <div th:if="${#lists.isEmpty(homeList)}" class="no-home">
        <p>등록된 숙소가 없습니다.</p>
    </div>
</div>

<div class="container seoul-list-container" th:if="${param.keyword == null}">
    <h2>서울의 인기 숙소</h2>
    <div class="row seoul-home-list">
        <div class="home-item" th:each="homeDto : ${seoulHomeList}">
            <a th:href="@{/home/detail/{homeIdx}(homeIdx=${homeDto.home.idx})}" class="home-link">
                <img th:src="${homeDto.home.thumbnail != null && !homeDto.home.thumbnail.isEmpty() ? homeDto.home.thumbnail : '/images/no-image.jpg'}"
                     alt="숙소 이미지" class="home-img">
            </a>
            <div class="home-text">
                <h3 class="home-title" th:text="${homeDto.home.title}">서울 숙소 제목</h3>
                <p class="home-desc" th:text="${homeDto.home.address}">서울 숙소 주소</p>
                <p class="home-like">❤️ <span th:text="${homeDto.likeCount}">0</span></p>
            </div>
        </div>
    </div>
    <div th:if="${#lists.isEmpty(seoulHomeList)}" class="no-home">
        <p>현재 서울의 인기 숙소가 없습니다.</p>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const listHeaderToggle = document.getElementById('listHeaderToggle');
    const homeListContainer = document.getElementById('homeListContainer');
    const toggleArrow = listHeaderToggle.querySelector('.toggle-arrow');
    const allHomeItems = document.querySelectorAll('#homeListContainer .home-item');
    const initialHomeCount = allHomeItems.length;

    // 숙소가 10개 이하일 경우 토글 기능은 필요 없으므로 숨깁니다.
    if (initialHomeCount <= 10) {
        if (toggleArrow) toggleArrow.style.display = 'none';
        return; 
    }

    // 초기 상태: 10개까지만 보이고, 11번째부터는 'hidden-item' 클래스로 숨겨진 상태 (펼쳐진 상태)
    let isExpanded = true; 

    // 목록 접기 함수 (11개 이후 항목 숨기기)
    function collapseList() {
        allHomeItems.forEach((item, index) => {
            if (index >= 10) {
                item.style.display = 'none';
            }
        });
        toggleArrow.classList.add('collapsed');
        isExpanded = false;
    }

    // 목록 펼치기 함수 (모든 항목 보이기)
    function expandList() {
        allHomeItems.forEach(item => {
            // 'hidden-item' 클래스를 가진 요소의 기본 display 속성을 'block' 또는 'flex' 등으로 설정
            item.style.display = 'block'; 
        });
        toggleArrow.classList.remove('collapsed');
        isExpanded = true;
    }
    
    // 초기에는 목록을 접어두기
    collapseList();


    // 헤더 클릭 이벤트 
    listHeaderToggle.addEventListener('click', function() {
        if (isExpanded) {
            collapseList();
        } else {
            expandList();
        }
    });
});
</script>

</body>
</html>