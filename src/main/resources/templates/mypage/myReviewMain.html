<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title>마이페이지</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" th:href="@{/css/fragments/fragments.css}">
  <link rel="stylesheet" th:href="@{/css/fragments/sidebar.css}">
  <link rel="stylesheet" th:href="@{/css/mypage/mypage.css}">
  <style>
    .review-card{border-radius:14px}
    .nav-tabs .nav-link{font-weight:600}
    .empty-state{color:#6c757d}
  </style>
</head>
<body>
  <div th:insert="~{fragments/header :: menuBar}"></div>

  <div class="mypage-layout-wrap container-fluid">
    <div class="row">
      <div class="mypage-sidebar-col">
        <div th:insert="~{fragments/sidebar :: guestSideBar}"></div>
      </div>

      <div class="mypage-content-col">
        <div class="mypage-content-area">
          <h1 class="mb-4">리뷰</h1>

          <!-- 탭 헤더 -->
          <ul class="nav nav-tabs" id="reviewTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="mine-tab" data-bs-toggle="tab" data-bs-target="#mine"
                      type="button" role="tab" aria-controls="mine" aria-selected="true">
                내가 작성한 후기
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="aboutme-tab" data-bs-toggle="tab" data-bs-target="#aboutme"
                      type="button" role="tab" aria-controls="aboutme" aria-selected="false">
                나에 대한 후기
              </button>
            </li>
          </ul>

          <!-- 탭 콘텐츠 -->
          <div class="tab-content pt-3">
            <!-- 내가 작성한 후기 -->
            <div class="tab-pane fade show active" id="mine" role="tabpanel" aria-labelledby="mine-tab" tabindex="0">
              <div th:if="${#lists.isEmpty(myReviews)}" class="empty-state">
                아직 작성한 후기가 없습니다.
              </div>

              <div class="vstack gap-3" th:if="${!#lists.isEmpty(myReviews)}">
                <div class="card review-card shadow-sm" th:each="r : ${myReviews}">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                      <div>
                        <h5 class="card-title mb-1" th:text="${r.homeTitle}">숙소 제목</h5>
                        <small class="text-muted" th:text="${#temporals.format(r.createdAt, 'yyyy.MM.dd')}">2025.01.01</small>
                      </div>
                      <div>
                        <span class="badge text-bg-primary" th:text="|★ ${r.rating}|">★ 5.0</span>
                      </div>
                    </div>
                    <p class="mt-3 mb-0" th:text="${r.content}">후기 내용</p>

                    <!-- 필요 시 상세/수정 링크 -->
                    <div class="mt-3 d-flex gap-2">
                      <a class="btn btn-sm btn-outline-secondary"
                         th:href="@{|/review/detail/${r.id}|}">상세보기</a>
                      <a class="btn btn-sm btn-outline-primary"
                         th:href="@{|/review/edit/${r.id}|}">수정</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 나에 대한 후기 -->
            <div class="tab-pane fade" id="aboutme" role="tabpanel" aria-labelledby="aboutme-tab" tabindex="0">
              <div th:if="${#lists.isEmpty(reviewsAboutMe)}" class="empty-state">
                아직 나에 대한 후기가 없습니다.
              </div>

              <div class="vstack gap-3" th:if="${!#lists.isEmpty(reviewsAboutMe)}">
                <div class="card review-card shadow-sm" th:each="r : ${reviewsAboutMe}">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                      <div>
                        <h5 class="card-title mb-1" th:text="${r.homeTitle}">숙소 제목</h5>
                        <small class="text-muted"
                               th:text="${r.reviewerNickname}">게스트 닉네임</small>
                        <small class="text-muted ms-2"
                               th:text="${#temporals.format(r.createdAt, 'yyyy.MM.dd')}">2025.01.01</small>
                      </div>
                      <div>
                        <span class="badge text-bg-success" th:text="|★ ${r.rating}|">★ 4.5</span>
                      </div>
                    </div>
                    <p class="mt-3 mb-0" th:text="${r.content}">후기 내용</p>

                    <!-- 필요 시 답글, 신고 등 액션 -->
                    <div class="mt-3 d-flex gap-2">
                      <a class="btn btn-sm btn-outline-secondary"
                         th:href="@{|/review/detail/${r.id}|}">상세보기</a>
                      <!-- <button class="btn btn-sm btn-outline-danger">신고</button> -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div> <!-- /tab-content -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // URL 해시(#mine, #aboutme)로 탭 유지
    (function () {
      const tabs = document.querySelectorAll('#reviewTabs [data-bs-toggle="tab"]');

      // 초기: 해시에 맞춰 탭 활성화
      const hash = window.location.hash;
      if (hash) {
        const triggerEl = document.querySelector(`#reviewTabs button[data-bs-target="${hash}"]`);
        if (triggerEl) {
          const tab = new bootstrap.Tab(triggerEl);
          tab.show();
        }
      }

      // 탭 변경 시 해시 업데이트
      tabs.forEach(btn => {
        btn.addEventListener('shown.bs.tab', function (e) {
          const target = e.target.getAttribute('data-bs-target'); // e.g. #aboutme
          history.replaceState(null, '', target);
        });
      });
    })();
  </script>
</body>
</html>
