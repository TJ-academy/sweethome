<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
</head>
<body>

	<div th:fragment="searchSection">
		<div class="main-content">
			<div class="search-container">
				<div class="search-item" id="destination-search-item">
					<label for="destination" class="search-label">여행지</label> <input
						type="text" id="destination" placeholder="여행지 검색" th:value="${keyword}" />
					<div class="recommendation-list" id="recommendation-list">
						<div class="recommendation-item" data-region="서울">
							<div class="item-icon icon-city">🏛️</div>
							<div class="item-text">
								<div class="item-title">서울</div>
								<div class="item-description">역사와 현대가 공존하는 한국의 중심지</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="경기">
							<div class="item-icon icon-city">🎡</div>
							<div class="item-text">
								<div class="item-title">경기</div>
								<div class="item-description">수도권 최대 규모의 해양문화공간과 복합 테마파크를
									즐길 수 있는 곳</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="인천">
							<div class="item-icon icon-sea">🏝️</div>
							<div class="item-text">
								<div class="item-title">인천</div>
								<div class="item-description">아름다운 섬들과 갯벌 체험, 역사적 등대가 있는 곳</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="대전">
							<div class="item-icon icon-city">🔬</div>
							<div class="item-text">
								<div class="item-title">대전</div>
								<div class="item-description">과학 명소와 황톳길, 메타세콰이어 숲 등 생태환경이
									풍부한 도시</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="세종">
							<div class="item-icon icon-city">🌳</div>
							<div class="item-text">
								<div class="item-title">세종</div>
								<div class="item-description">국립수목원, 호수공원 등 다양한 휴식 공간이 있는
									행정 중심 복합도시</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="충남">
							<div class="item-icon icon-sea">🌊</div>
							<div class="item-text">
								<div class="item-title">충남</div>
								<div class="item-description">광활한 갯벌과 고운 백사장, 아름다운 일출을 간직한
									서해의 명소</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="충북">
							<div class="item-icon icon-mountain">⛰️</div>
							<div class="item-text">
								<div class="item-title">충북</div>
								<div class="item-description">단양 패러글라이딩, 이끼터널 등 자연경관이 아름다운
									내륙의 명소</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="광주">
							<div class="item-icon icon-city">🎨</div>
							<div class="item-text">
								<div class="item-title">광주</div>
								<div class="item-description">문화와 예술, 그리고 맛의 도시로 불리는 예향</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="전남">
							<div class="item-icon icon-sea">🎋</div>
							<div class="item-text">
								<div class="item-title">전남</div>
								<div class="item-description">죽녹원, 느러지전망대, 해상케이블카 등 아름다운
									비경과 자연이 가득한 곳</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="전북">
							<div class="item-icon icon-city">韓</div>
							<div class="item-text">
								<div class="item-title">전북</div>
								<div class="item-description">단풍으로 유명한 내장산과 근대 유산이 풍부한 군산
									등 역사가 깊은 예향의 고장</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="대구">
							<div class="item-icon icon-city">🥖</div>
							<div class="item-text">
								<div class="item-title">대구</div>
								<div class="item-description">서문시장, 근대골목 등 볼거리와 먹거리가 가득한
									활기 넘치는 도시</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="경북">
							<div class="item-icon icon-mountain">🏘️</div>
							<div class="item-text">
								<div class="item-title">경북</div>
								<div class="item-description">퇴계 선생의 가르침이 남아있는 도산서원, 독도 일출
									등 역사와 자연이 공존하는 곳</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="부산">
							<div class="item-icon icon-sea">🌉</div>
							<div class="item-text">
								<div class="item-title">부산</div>
								<div class="item-description">해운대, 송도 등 바다의 정석을 보여주는 우리나라
									최대 해양도시</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="울산">
							<div class="item-icon icon-sea">🐳</div>
							<div class="item-text">
								<div class="item-title">울산</div>
								<div class="item-description">태화강 국가정원, 간절곶 등 생태정원과 해양문화가
									어우러진 산업 수도</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="경남">
							<div class="item-icon icon-sea">⛴️</div>
							<div class="item-text">
								<div class="item-title">경남</div>
								<div class="item-description">한려해상국립공원, 진주성과 같이 바다와 역사가
									조화를 이루는 곳</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="강원">
							<div class="item-icon icon-mountain">❄️</div>
							<div class="item-text">
								<div class="item-title">강원</div>
								<div class="item-description">설악산, 경포대 등 웅장한 산맥과 동해안 바다가
									어우러진 대한민국 대표 휴양지</div>
							</div>
						</div>
						<div class="recommendation-item" data-region="제주">
							<div class="item-icon icon-island">🍊</div>
							<div class="item-text">
								<div class="item-title">제주</div>
								<div class="item-description">돌과 바람, 오름과 푸른 바다가 함께하는 대한민국
									최고의 섬 관광지</div>
							</div>
						</div>
					</div>
				</div>

				<div class="search-item">
					<label for="checkin" class="search-label">체크인</label> <input
						type="date" id="checkin" placeholder="날짜 추가" th:value="${checkin}" />
				</div>
				<div class="search-item">
					<label for="checkout" class="search-label">체크아웃</label> <input
						type="date" id="checkout" placeholder="날짜 추가" th:value="${checkout}" />
				</div>
				
				<div class="search-item" id="guest-search-item">
					<div style="flex-grow: 1;">
						<label for="guests" class="search-label">여행자</label> 
						<input type="text" id="guests" placeholder="게스트 추가" readonly
							style="cursor: pointer; background-color: transparent;" th:value="${(adults != 0 or children != 0) ? 
        '성인 ' + adults + '명' + (children != 0 ? ', 어린이 ' + children + '명' : '') : ''}" />
					</div>

					<div class="search-button-wrap">
						<button class="search-button">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
								fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                        <path
									d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.041.062.083.098.124l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.124-.099zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                    </svg>
						</button>
					</div>
					
					<div class="guest-settings" id="guest-settings">
						<div class="guest-item">
							<div class="guest-info">
								<h4>성인</h4>
								<p>13세 이상</p>
							</div>
							<div class="guest-controls">
								<button class="decrement-btn" data-type="adult" disabled>-</button>
								<span class="count" id="adult-count">0</span>
								<button class="increment-btn" data-type="adult">+</button>
							</div>
						</div>
						<div class="guest-item">
							<div class="guest-info">
								<h4>어린이</h4>
								<p>2~12세</p>
							</div>
							<div class="guest-controls">
								<button class="decrement-btn" data-type="child" disabled>-</button>
								<span class="count" id="child-count">0</span>
								<button class="increment-btn" data-type="child">+</button>
							</div>
						</div>
					</div>
					
				</div>
			</div>
		</div>

<script th:inline="javascript">
	document.addEventListener('DOMContentLoaded', function() {
	    // Controller에서 전달받은 값 (초기화, 값이 없으면 0으로 설정)
	    // 안전한 인라인 주석 형태를 사용하여 JavaScript 문법 오류를 방지합니다.
	    const initialAdults = /*[[${adults != null ? adults : 0}]]*/ 0; 
	    const initialChildren = /*[[${children != null ? children : 0}]]*/ 0;
	    
	    // 여행지 검색 관련 요소
	    const destinationSearchItem = document.getElementById('destination-search-item');
	    const destinationInput = document.getElementById('destination');
	    const recommendationList = document.getElementById('recommendation-list');
	    const recommendationItems = document.querySelectorAll('.recommendation-item');
	    const searchButton = document.querySelector('.search-button');
	
	    // ✅ 여행자 검색 관련 요소
	    const guestSearchItem = document.getElementById('guest-search-item');
	    const guestInput = document.getElementById('guests');
	    const guestSettings = document.getElementById('guest-settings');
	    const adultCountSpan = document.getElementById('adult-count');
	    const childCountSpan = document.getElementById('child-count');
	    const incrementButtons = document.querySelectorAll('.increment-btn');
	    const decrementButtons = document.querySelectorAll('.decrement-btn');
	
	    // ✅ Controller에서 받은 초기값으로 변수 초기화
	    let adultCount = initialAdults;
	    let childCount = initialChildren;
	
	    // --- 여행지 목록 표시/숨김 함수 ---
	    function toggleDestinationList(show) {
	        if (show) {
	            recommendationList.style.display = 'block';
	            recommendationList.style.visibility = 'visible';
	            destinationSearchItem.classList.add('active');
	            toggleGuestSettings(false); // 여행지 목록 표시 시 인원수 팝업 숨김
	        } else {
	            recommendationList.style.display = 'none';
	            recommendationList.style.visibility = 'hidden';
	            destinationSearchItem.classList.remove('active');
	        }
	    }
	    
	    // --- ✅ 인원수 팝업 표시/숨김 함수 ---
	    function toggleGuestSettings(show) {
	        if (show) {
	            guestSettings.style.display = 'block';
	            guestSettings.style.visibility = 'visible';
	            guestSearchItem.classList.add('active');
	            toggleDestinationList(false); // 인원수 팝업 표시 시 여행지 목록 숨김
	        } else {
	            guestSettings.style.display = 'none';
	            guestSettings.style.visibility = 'hidden';
	            guestSearchItem.classList.remove('active');
	        }
	    }
	
	    // --- ✅ 인원수 업데이트 및 UI 반영 함수 ---
	    function updateGuestCount() {
	        const total = adultCount + childCount;
	        
	        // input 값 업데이트
	        if (total === 0) {
	            guestInput.value = '';
	            guestInput.placeholder = '게스트 추가';
	        } else if (childCount === 0) {
	            guestInput.value = `성인 ${adultCount}명`;
	        } else {
	            guestInput.value = `성인 ${adultCount}명, 어린이 ${childCount}명`;
	        }
	
	        // 팝업 내부의 숫자 업데이트
	        adultCountSpan.textContent = adultCount;
	        childCountSpan.textContent = childCount;
	        
	        // 버튼 비활성화/활성화 로직
	        document.querySelector('.decrement-btn[data-type="adult"]').disabled = adultCount === 0;
	        document.querySelector('.decrement-btn[data-type="child"]').disabled = childCount === 0;
	    }
	
	    // --- 검색 실행 함수 (쿼리 파라미터에 모든 검색 조건 추가) ---
	    function performSearch() {
	        const keyword = destinationInput.value.trim();
	        
	        /*
	        if (keyword === '') {
	            alert('여행지를 입력해주세요.');
	            destinationInput.focus();
	            return;
	        }
	        */
	        
	        const checkin = document.getElementById('checkin').value;
	        const checkout = document.getElementById('checkout').value;
	
	        // 여행자 정보를 포함한 검색
	        const searchParams = new URLSearchParams();
	        searchParams.append('keyword', keyword);
	        searchParams.append('adults', adultCount);
	        searchParams.append('children', childCount); // children 값 추가
	        if(checkin) searchParams.append('checkin', checkin);
	        if(checkout) searchParams.append('checkout', checkout);
	        
	        // 실제 검색 URL로 이동
	        window.location.href = `/search?${searchParams.toString()}`;
	    }
	    
	    // --- ✅ 이벤트 리스너: 여행자 항목 클릭 시 팝업 표시 ---
	    guestSearchItem.addEventListener('click', function(event) {
	    	event.stopPropagation();
	        toggleGuestSettings(true);
	    });
	
	    // --- ✅ 이벤트 리스너: 인원수 증가/감소 버튼 ---
	    document.querySelectorAll('.guest-controls button').forEach(button => {
	        button.addEventListener('click', function(event) {
	            event.stopPropagation(); // 팝업이 닫히지 않도록 막음
	            const type = this.getAttribute('data-type');
	            const isIncrement = this.classList.contains('increment-btn');
	            
	            if (type === 'adult') {
	                if (isIncrement) {
	                    adultCount++;
	                } else if (adultCount > 0) {
	                    adultCount--;
	                }
	            } else if (type === 'child') {
	                if (isIncrement) {
	                    childCount++;
	                } else if (childCount > 0) {
	                    childCount--;
	                }
	            }
	            updateGuestCount();
	        });
	    });
	
	    // --- 이벤트 리스너: 입력 필드 클릭/포커스 시 목록 표시 (여행지) ---
	    destinationInput.addEventListener('click', function(event) {
	        event.stopPropagation();
	        toggleDestinationList(true);
	    });
	
	    destinationInput.addEventListener('focus', function() {
	        toggleDestinationList(true);
	    });
	
	    // --- 이벤트 리스너: 외부 클릭 시 모든 팝업 숨김 ---
	    document.addEventListener('click', function(event) {
	        // 여행지 목록 외부 클릭
	        if (!destinationSearchItem.contains(event.target)) {
	            toggleDestinationList(false);
	        }
	        // 인원수 팝업 외부 클릭
	        if (!guestSearchItem.contains(event.target)) {
	            toggleGuestSettings(false);
	        }
	    });
	
	    // --- 이벤트 리스너: 지역 항목 클릭 시 입력 필드 값 변경 ---
	    recommendationItems.forEach(item => {
	        item.addEventListener('click', function(event) {
	            const regionName = item.querySelector('.item-title').textContent;
	            destinationInput.value = regionName;
	            toggleDestinationList(false);
	            document.getElementById('checkin').focus();
	            event.stopPropagation();
	        });
	    });
	
	    // --- 이벤트 리스너: 입력 시 필터링 (여행지) ---
	    destinationInput.addEventListener('input', function() {
	        const filter = destinationInput.value.toLowerCase();
	        recommendationItems.forEach(item => {
	            const title = item.querySelector('.item-title').textContent.toLowerCase();
	            item.style.display = title.includes(filter) ? 'flex' : 'none';
	        });
	    });
	
	    // --- 이벤트 리스너: 검색 버튼 클릭 시 검색 실행 ---
	    searchButton.addEventListener('click', function(event) {
	        event.preventDefault();
	        performSearch();
	    });
	
	    // --- 이벤트 리스너: 엔터 키로 검색 실행 (여행지 입력 필드) ---
	    destinationInput.addEventListener('keypress', function(event) {
	        if (event.key === 'Enter') {
	            event.preventDefault();
	            performSearch();
	        }
	    });
	    
	    // DOM 로드 후 Controller에서 받은 초기값으로 UI를 업데이트합니다.
	    updateGuestCount();
	});
</script>
</div>

</body>
</html>